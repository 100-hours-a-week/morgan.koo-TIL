# S3

- 관리형 스토리지 솔루션
- 버킷 안에 데이터를 객체로 저장 - 볼륨과 유사
    - 단일 객체는 최대 5TB까지 저장 - S3fs를 활용해 마운트하면 최대 256TB까지
- 버킷 및 객체에 대한 접근 제어 설정 가능
- 파일에 대한 암호화 기능 제공
    - SSE(Server-Side Encryption)
    - CSE(Client-Side Encryption)
- HTTP(S) 통해 인터넷에서 접근 가능
- VPC를 통해 AWS 내부망 접근 가능
- 데이터 사용 특성에 맞는 저장 계층 제공(데이터 타입 기반)
- Cloud Watch(모니터링 서비스)와 로그 인사이트를 사용할 때 주로 사용 → 로그 적재
- 버킷 이름은 전체 AWS 사용자들에 대해 유일한 값이어야 한다
    - 리전에 관계 없이 글로벌 서비스이기 때문
    - 3~63자
- 글로벌 서비스이긴 하지만 실제로 버킷은 특정 리전 내 데이터 센터에 있기 때문에 물리적 거리가 멀다면 데이터 로딩 시간이 오래걸린다
- 리전 간 복제: 특정 리전에 저장된 버킷 내의 객체들을 다른 리전/버킷으로 복제하는 기능
    - 백업 용도
    - 특정 지역 사용자들이 빠르게 접근할 수 있도록 하기 위해
- 모든 객체가 버킷 하위에 저장되는 플랫 파일 시스템
    - 버킷 내 객체 이름에 ‘/’를 포함하면 디렉토리 구조로 표현된다
- 데이터 전송 비용
    - S3에 업로드하는 비용은 무료
    - 다운로드 비용은 경우에 따라 유료 - 인터넷망을 통해 S3에서 다운로드하는 경우(아웃바운드 통신), 서로 다른 AZ/리전 간 통신도 유료
    - 100GB까지는 다운로드 무료이며, EC2 인스턴스에서 AWS 내부 네트워크를 통해 다운로드할 때도 무료
- **S3의 지속성**
    - 갑작스런 데이터 유실과 손상을 방지할 수 있는 정도
    - 1년동안 데이터를 온전히 저장할 가능성
- **S3의 가용성**
    - 특정 데이터 접근 시 정상적으로 해당 데이터를 사용할 수 있을 확률
- **S3 전체 비용**
    - S3 전송비용
    - 업로드한 데이터 크기
    - 스토리지 클래스
- **접근 권한**
    - S3는 접근 가능한 엔드포인트 url이 제공된다 따라서 접근 주체를 제어해야 한다
    - 버킷 정책 - 리소스 기반: 버킷의 속성에 접근 가능한 주체 지정, 객체 별로 읽기/쓰기 허용 결정
    - 사용자 정책 - 신원 기반: IAM 사용자에게 할당된 권한에 버킷과 객체에 대한 권한 명시
    - 버킷 및 객체 접근 제어 리스트: 다른 AWS 계정에 버킷에 대한 접근 권한 부여
- **버전 관리**
    - 데이터가 덮어써지거나 삭제되는 것을 방지하기 위해 버전관리 사용, 기본적으로 비활성화 상태
    - 객체가 변경되거나 삭제될 때 이전 상태를 버전 넘버를 할당하여 보관
- **객체 생명주기** - S3엔 제한없이 데이터를 업로드 할 수 있기 때문에 로그와 같이 자동생성되는 데이터를 업로드하도록 설정하면 과도한 요금이 발생할 수 있다
    - 전환 작업: 객체 생성 후 다른 스토리지 클래스로 전환되는 시기를 정의
    - 만료 작업: 객체 생성 후 특정 시간 이후 자동으로 객체를 삭제

## 스토리지 클래스

- S3에 저장하려는 파일은 유실을 허용하는 정도에 차이가 있다
- 저장소 안정성에 따라 S3 저장 비용에 차등이 존재하기에, 그에 적합한 저장소를 선택해야한다
- 이러한 저장소 등급 차이를 스토리지 클래스라 한다
- 빈번하게 접근하는 경우
    - **스탠다드** - 가장 빠른 응답 성능
    - **Reduced Redundancy(RRS)**
        - 가장 낮은 지속성
        - 스탠다드와 동일한 수준의 가용성
- 적은 빈도로 접근하는 경우
    - **스탠다드 IA(Infrequent Access)**
        - 스탠다드 대비 낮은 가용성, 재생성 어려운 데이터 저장에 적합
        - 여러 가용영역에 데이터 복제 저장
    - **One Zone IA**
    - **S3 Glacier**(주로 업로드만)
        - 법적 요구나 필요에 따라 장기 보관 하는 경우(아카이빙)
        - 압축파일 등으로 만들어 저장하는 것을 아카이브라고 한다
        - 볼트(Vault): 아카이브를 저장하고 관리할 수 있는 공간 - 리전 내 유일한 이름을 가져야 함
        - 볼트의 생성/삭제는 콘솔에서 가능하지만 아카이브를 업로드/다운로드/삭제하는 작업은 CLI나 SDK가 필요
        - 저장된 객체는 곧바로 사용이 불가하며, 즉각적 사용이 가능한 클래스로 이동시키는 요청이 필요
- 빈도 모니터링하여 자동으로 선택
    - **Intelligent Tiering**

# AWS 보안

## IAM 권한

- AWS 계정을 사용하는 IAM 사용자가 지정된 서비스에 대해 리소스를 생성 및 제어 할 수 있게 하는 기능
- Identity Based Policy: 정책에 정의한 내용을 바탕으로 서비스와 생성된 리소스에 접근할 권한을 갖게 된다
    - IAM 엔티티에 대해 권한을 부여(사용자, 역할, 그룹)
- Resource Based Policy: 리소스에 직접 정책을 설정하고 접근 대상을 지정한다
    - S3, EFS 등 특정 서비스만 가능

## 정책 평가 방법

- 자격증명 및 리소스 기반 정책 평가 - 최종 권한
    - 자격증명 기반/리소스 기반 정책에서 허용(Allow)하는 권한
    - 둘 중 하나라도 명시적 거부(Deny)가 있을 경우 접근 불가 - 거부가 항상 우선순위 높음

# AWS 네트워크 서비스

## 탄력적 네트워크 인터페이스

- Elastic Network Interface
- Network Interface Card
    - NIC에 IP를 할당하여 이를 통해 컴퓨터 간 통신이 이루어진다
    - NIC가 여러 개 설치되어 있다면 하나의 기기에서 여러 네트워크에 접속 가능하다
- AWS는 ENI를 통해 EC2 인스턴스에 네트워크 카드를 가상으로 연결 - 생성 시, 기본 ENI 생성 및 연결
- 서브넷의 IP 대역 중 하나가 EC2 인스턴스 ENI에 할당되며 네트워크에 연결
- 공인 IP도 ENI에 연결됨
- **Load Balancer Pre-warming**: 예상되는 트래픽 급증에 대비하여 로드 밸런서의 처리 용량을 미리 확보하는 과정

## 네트워크에 대한 접근 제어

- 보안그룹을 통해 EC2 인스턴스에 접근 가능한 네트워크 영역을 제한
    - 인바운듯/아웃바운드 규칙을 정해 트래픽 제어 → 방화벽 역할
    - 규칙이 아예없다면 기본적으로 전체 거부
- NACL

# VPC

- DHCP 설정
    - 네트워크에 연결된 장치에 IP 자동 부여하는 기능
    - VPC 생성 시, 기본적으로 DHCP가 동작하여 VPC 내 서버에 자동으로 IP 할당
    - VPC 내 서브넷 CIDR 블록에 맞게 자동할당됨
- **Public Subnet**
    - 라우팅 테이블을 통해 인터넷 게이트웨이와 연결된 서브넷
- **Private Subnet**
    - 인터넷을 통해 외부 접근이 불가능한 서브넷
    - 왜 필요한가 - 인터넷에 연결된 장치는 언제든지 공격의 대상이 될 수 있다 → 인터넷 연결이 필요없는 서버는 가급적 네트워크에서 격리된 곳에 위치시키는 것이 보안 원칙
- 고가용성을 확보하기 위해서는 2개 이상의 AZ를 확보하여 각각 퍼블릭/프라이빗 구축해야함
- NAT를 통한 프라이빗 서브넷에서의 인터넷 접근
    - 프라이빗 → 라우팅 테이블 → NAT 게이트웨이 → 인터넷 게이트웨이