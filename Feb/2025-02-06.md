# 네트워크 보안

**날짜: 2025-02-06**

**스크럼**

- 어제 진행한 실습 중 나의 어처구니 없는 실수가 있었음을 깨달았다
- 팀원끼리 서로 좋아하는 음식을 공유 했다

**새로 배운 내용**

# 보안

- 용어 자체는 보편화된 용어
- 그럼에도 정확히 정의하는 것은 어려움
- 보안의 필요성은 알고 있지만, 그에 대해 심각하게 고민해 프로젝트를 계획, 운영하는 사람은 많지않다
- IT업계 **전반에서** 고려해야한다 - 개발자, 서버 엔지니어, 네트워크 엔지니어, 보안 엔지니어

# 정보 보안

- 다양한 위협으로부터 정보를 보호하는 것
    - 우리가 생산하거나 유지해야 할 정보에 위험이 발생하거나 사고가 날 염려없이 편안하고 온전한상태를 유지하는 일련의 활동
- 생산자와 소비자 입장으로 구분
    - 외부에서 정보가 저장된 시스템을 사용하지 못하게 하거나 유출 시도에 맞서 적절히 보호
    - 운영하기 위한 작업과 정보가 내부에서 유출되거나 남용되는 것을 막는 것
- **깨알 AWS**
    - IAM 사용자 권한 중 `ViewOnlyAccess`(읽기 전용)를 부여할 수 있다
    - 네트워크 ACL: 넓은 범위의 보안 설정(라우터)
    - 보안 그룹: 특정 인스턴스의 방화벽
    - AWS Network Firewall: ASA(Adaptive Security Appliance) 방화벽
    - AWS WAF: VPC/네트워크 앞 쪽에 위치 (API Gateway, Load Balancer)
    - AWS Shield, CloudFront: DDoS 방어
- `기획 → 구축 → 운영` 중 보안 서비스도 기획 및 구축 단계에서 고려해야 한다
    - 보안 솔루션 설치 및 적용

# 보안의 3대 요소

- **기밀성(Confidentiality)**: 인가되지 않은 사용자의 접근 제한
    - `암호화`
- **무결성(Integrity)**: 완전한 정보 유지
    - `MD5`, `SHA` 같은 해시 함수를 통해 상태 확인
- **가용성(Availability)**: 정보가 필요할 때, 접근 허락
    - `로드밸런서`, `CI/CD 무중단` , `관제`
    - 정보를 사용할 수 없는 상황이라면 정보 보안에 실패한 것
- **인가된** 사용자만 **정확하고 완전한 정보**로 **필요할 때 접근**할 수 있게 하는 것

# 네트워크 보안

- **네트워크는 중요한 정보유출 영역**
- 네트워크가 없다면 정보의 이동이 어려워지므로 정보에 대한 사용도 원활해지지 않는다
- 자유로운 네트워크의 성질 때문에 적절한 통제가 필요
- 정보 서비스를 정상적으로 구동할 수 없게 만드는 행위를 네트워크에서 적절히 막는 것이 네트워크 보안의 `1차 목표`
- 정보는 한 자리에만 있는 것이 아니라 네트워크를 통해 복제, 이동되므로 그 유출을 막는 것이 `2차 목표`
- 네트워크 보안은 외부 공격에 맞서는 중요한 1차 방어선
    - 대부분의 데이터와 애플리케이션 서비스들이 네트워크에 연결된 상황
    - 시스템과 애플리케이션에 결함이나 취약점이 있어도 네트워크의 다양한 보안 장비를 활용하면 공격을 늦추거나 방어할 수 있다
- `Trust` 네트워크: 외부로부터 보호받아야 할 네트워크
- `Untrust` 네트워크: 신뢰할 수 없는 외부 네트워크(인터넷)
- `DMZ` 네트워크: 내부 네트워크이지만 신뢰할 수 없는 외부 사용자에게 개방해야하는 서비스 네트워크
    - 인터넷에 공개되는 서비스
- **인터넷 시큐어 게이트웨이**: `Trust`  → `Untrust` 통신을 통제
    - 인터넷에 수많은 서비스가 있으므로 그에 대한 정보와 요청 패킷을 적절히 필터링하는 기능
    - 방화벽, SWG(Secure Web Gateway), 웹 필터, 애플리케이션 컨트롤, 샌드박스
- **데이터 센터 시큐어 게이트웨이**: `Untrust`  → `Trust` 통신을 통제
    - 고성능이 필요하고 외부의 직접적인 공격을 막기 위해 공격 관련 정보가 더 중요
    - 방화벽, IPS, DCSG(DataCenter, Secure Gateway), WAF, Anit-DDoS
- **화이트리스트**: 전체를 막아놓고 허용된 통신을 지정
    - 방어에 문제가 없다고 명확히 판단디는 통신만 허용 - IP와 통신 정보
    - 회사 내부에서 사용하는 방화벽
    - 통신 정보를 상세히 알아야 하고 세부적인 통제가 필요
- **블랙리스트**: 전체를 허용해놓고 제한된 통신을 지정
    - 공격이라고 명확히 판단되거나 문제가 발생한 IP 또는 패킷 리스트
    - 각종 패턴으로 공격을 방어하는 네트워크 장비(IPS, WAF, 안티바이러스)
    - 공격을 당할 때 공격 기법을 판단해 탐지하도록 데이터베이스로 생성 - **시그니처**
- `정탐`: 공격을 제대로 탐지
- `오탐`: 정상 상황을 공격으로 탐지
    - 오탐을 줄이는 튜닝작업 필요
    - 데이터베이스 업데이트 전에 발생하는 제로 데이 공격 때 발생
- `미탐`: 공격을 탐지하지 못함

# 보안 솔루션

- 기업이나 기관에서 보안을 강화하기 위해 실제 사용하는 사용 하드웨어/소프트웨어 제품
- 인라인 상에 여러 장비를 배치하여 단계적으로 방어
    - DDoS 방어 장비 -  방화벽 - IPS - WAF

## DDoS 방어 장비

- 프로파일링
    - 평소 데이터 흐름을 습득 - 대역폭, 세션량, 초기 접속량, 프로토콜 별 사용량 등
    - 습득 데이터와 다른 트래픽이 오면 알림 및 차단
- 보안 데이터베이스(IP 평판 데이터베이스)를 공유해 DDoS 공격으로 사용된 IP 기반 또는 공격 패턴을 방어
- 클라우드 서비스, 회선 사업자 방어 서비스, DDoS 방어 장비 설치
- 회선 사업자와 방어 장비를 이원화하는 서비스
- DDoS는 대규모 공격이므로 탐지 장비와 방어 장비를 구분하는 경우도 많다
    - 탐지 장비가 공격 IP 리스트를 넘겨주면 방어 장비나 ISP 내부에서 IP를 차단
- 공격에 동원된 IP를 찾는 것은 쉽지만 C&C(Command and Control) 서버를 찾기는 어렵다
- 방어 장비는 데이터 센터 네트워크 내부와 외부의 경계에서 방어(볼류메트릭 우선 방어)
- DDoS 공격의 종류
    - **볼류메트릭 공격**: 회선 사용량 꽉 채우기
        - 대상의 대역폭을 대용량 트래픽으로 포화
        - NTP 증폭, DNS 증폭, UDP 플러드, TCP 플러드
    - **프로토콜 공격**: 3, 4계층 프로토콜 스택 취약점 악용
        - 네트워크 장비의 CPU, 메모리 자원 고갈시킴
        - Syn 플러드, Ping of Death
    - **애플리케이션 공격**: 애플리케이션 취약점 악용
        - 가장 정교하여 완화가 까다로움
        - HTTP 플러드, Slowloris, DNS 공격

# 방화벽

- 4계층에서 동작하는 패킷 필터링 장비
- 3, 4 계층 정보를 기반으로 정책을 세울 수 있고 해당 정책과 매치되는 패킷이 방화벽을
통과하면 그 패킷을 허용하거나 거부 (Deny) 할 수 있음
- 일반적으로 방화벽은 DDoS 방어 장비 바로 뒤에 놓는 네트워크 보안 장비
- 초기 방화벽
    - 패킷이 들어오면 방화벽 정책과 비교(5-튜플 조건을 참고)
    - 5-튜플: Source IP, Destination IP, Procotocl No, Source Port, Destination Port
    - 인터넷 통신과 같이 불특정 다수 기반의 정책을 정의할 때는 룰셋 (Ruleset) 이 복잡해지고
    보안이 약화되는 문제
- 현대 방화벽(SPI 엔진)
    - 상태 기반 방화벽 (Stateful Inspection Firewall)
    - 출발지는 모든 IP
    - 내부에서 외부 호출 시 랜덤 포트 지정하므로 모든 포트
- **방화벽 동작 방식**
    1. 장비에 패킷이 들어오면 우선 **세션 상태 테이블**을 확인
    2. 조건에 맞는 세션 정보가 세션 테이블에 있을 때, 포워딩 테이블을 확인 (라우팅 , ARP 포함)
    3. 조건에 맞는 세션 정보가 세션 테이블에 없을 때, 방화벽 정책을 확인
    4. 방화벽 정책은 맨 위의 정책부터 확인해 최종 정책까지 확인한 후 없을 때 암시적인
    거부 규칙을 참고해 차단
    5. 허용 규칙이 있으면 내용을 세션 테이블에 적어 넣음
    6. 포워딩 테이블을 확인 (라우팅 , ARP 포함)
    7. 조건에 맞는 정보가 포워딩 테이블에 있을 때, 적절한 인터페이스로 패킷을 포워딩
    8. 조건에 맞는 정보가 포워딩 테이블에 없을 때, 패킷을 폐기

# IDS, IPS

- 방화벽에서 방어할 수 없는 다양한 애플리케이션 공격을 방어하는 장비
- 시그니처를 사전에 제공받아 공격 패턴을 기반으로 동작
- 3~7계층을 방어
- **IDS(Intrusion Detection System)**: 트래픽을 복제해 검토하여 침입 여부 판별
- **IPS(Intrusion Prevention System)**: 공격이 발견되면 직접 차단
    - 인라인에 직접 설치
    - 호스트 기반(**HIPS**)과 네트워크 기반(**NIPS**, 일반적인 경우)
    - 기본적으로 `패턴 매칭` 을 사용하며, `프로토콜 어노말리`, `프로파일 어노말리` 방식도 사용
- `패턴 매칭`: 기존 공격이나 취약점을 통해 공격 방식에 대한 데이터베이스(시그니처)를 습득해 그 패턴을 기반으로 방어하는 방식 - 블랙리스트 기반
    - 시그니처를 최신화하여 유지하는 것이 매우 중요
    - 패턴 기반의 방어는 극미한 변화에도 대응이 어렵고 인터넷 상으로 빠르게 전파되는 변종 웜 공격을 제 시간에 막아내기 어렵다
- `어노말리 공격 방어` : 분명한 공격으로 파악되지 않아도 특정 기준 이상의 행위를 이상하다 판단하고 방어하는 방식
    - 패턴 기반 방어의 한계 때문에 개발된 화이트리스트 기반 방어
    - 프로파일 어노말리: 관리자가 정해놓은 기준이나 IPS 장비가 정한 기준과 다른 행위를 공격으로 간주 → 향후 DDoS 방어 장비로 진화
    - 프로토콜 어노말리: 잘 알려진 포트와 실제로 통신하는 프로토콜이 다를 때 제어하는 방식
        - 해커는 방화벽을 우회해 공격하기 위해 웹 서버나 이메일에 악성 코드를 심어놓고 내부 사용자가 악성 코드를 내려받아 직접 실행하도록 유도 → 이 때 실제 서비스의 프로토콜이 아닌 다른 프로토콜을 사용

**오늘의 도전 과제와 해결 방법**

- 패킷 트레이서로 ASA 방화벽 구축해보기

**오늘의 회고**

- 패킷 트레이서를 이용해 직접 방화벽 구축을 해보니 어떤 원리로 방화벽이 접근을 제한하고 허용하는지 많이 알게 되었다. 내가 컴퓨터 사용할 땐 마우스 딸깍이었는데 실제론 라우팅, NAT, ACL 설정이 필요한 꽤나 복잡한 과정이었다.

**참고 자료 및 링크**