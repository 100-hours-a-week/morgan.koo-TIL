# IT 서비스 운영

- 24/7 안정적인 서비스를 제공하는 것이 필수
- 상용 IT 서비스: 장애가 무조건 날 수 밖에 없다 → **최대한 빠르게 극복하는 법이 중요**
    - 버그가 실패로 이어지지 않는 아키텍처
- 안정적인 인프라: 서버 간 연결을 위한 네트워크 등에 사용하는 SW & HW 장비
    - 장비 자체의 안정성
    - 안정적인 전원 공급
    - 온도 및 습도 관리
    - 데이터 센터의 등장(온프레미스) - UPS(Uninterruptible Power Supply)
    - 서버 컴퓨터 사이 물리적 간격을 두어 발열로 인한 성능 저하나 화재를 예방

# 전통적인 IT 서비스 구축

- 서버 등 장비 구매하거나 데이터 센터를 직접 구축할 때
    - 구축 기간의 지연: 복잡한 과정(구매 요청, 제작, 납품)
    - 비용의 증가(사용자 규모 예측에 실패 → 서비스 장애, 즉각적인 장비 추가 구매 어려움)

# 클라우드 환경에서의 IT 서비스 구축 과정

1. 기획
2. 서버 등 장비를 **대여 요청**
3. 클라우드 컴퓨팅 서비스로 개발 환경을 구성
4. 개발 진행
5. 서비스 시작

## 장점

- 미리 준비된 인프라를 대여 → 낮은 초기 비용과 짧은 구매 기간
    - 장비를 클라우드 서비스 제공자로부터 가상화 형태로 대여
    - 원하는 때에 원하는 만큼 장비 대여(On-Demand)
    - 사용한 만큼만 비용 지불(Pay-as-you-go)
- 글로벌 서비스를 진행하기에도 용이 - 리전만 바꾸면 됨
- 필요한 만큼 사용하기 때문에 사용자 규모를 예측할 필요가 없다

## 서버 가상화

- 물리 서버 상에서 가상머신을 실행하여 사용자에게 대여
- 탄력적으로 대여 규모를 확대/축소 가능

# Amazon Web Services

- 현시점 세계에서 가장 큰 클라우드 공급 회사
- Amazon: 온라인 서점 → 대규모 종합 쇼핑몰
- AWS는 Amazon 운영을 위한 플랫폼이었으나, 외부에서도 사용할 수 있게 공개하면서 클라우드 컴퓨팅 회사로 성장
- 컴퓨팅 파워, 스토리지, 데이터베이스와 같은 기술 서비스 제공

# AWS 글로벌 인프라

## 리전(Regions)

- 특정 지역에 위치한 데이터 센터들의 집합
- 전세계 31개의 리전 존재
    - 99개의 가용 영역
    - 400개 이상의 Edge location - CDN
- 지리적 이유로(영토 크기) 한 나라에 여러 리전이 존재하기도 한다
- **리전 기반 서비스**: 특정 리전에서 할당받은 서비스는 해당 리전 내 데이터 센터에서만 구동(EC2, VPC, RDS 등)
    - AWS 리소스 생성 전에 리전을 잘 확인해야 한다 - 서비스에 문제를 유발하거나, 예상 범위 밖 비용 발생
- **글로벌 기반 서비스:** 리전 구분이 무의미한 서비스
    - IAM: 사용자 관리 기능이므로 리전 구분이 의미 없다
    - CloudFront: CDN 서비스 - 전세계 Edge Location에 사용자 데이터를 캐싱하기 때문에 리전 구분X
    - S3: 실제 데이터는 특정 리전에 있지만 서비스는 글로벌

## 가용 영역(Availability Zone)

- 리전 내 사용자가 생성하려는 리소스가 **어떤 데이터 센터에 만들어지는 지** 인지할 수 있도록 영역 구분한 것
- 작은 데이터 센터 여러 개를 묶거나 대규모 데이터 센터 하나를 가용 영역으로 지정
- 왜 이런 구조인가 - 서비스의 고가용성 확보(이중화)
- 동일한 가용 영역에만 리소스 생성 시, 고가용성 확보가 어렵다
- 확장성과 복원성 역시 고가용성을 함께 고려해야 한다

## 신뢰도

- 시스템이 의도대로 동작하고 실패하지 않을 것이라는 사실에 대한 확신의 정도
- 결함: 잘못된 동작을 유발할 수 있는 특성 - 코드 버그
- 실패: 시스템이 실제로 오동작 하거나 동작을 멈추는 것
- 결함 최소화 방법론
    - 결함 회피: 컴파일러가 다양한 유형의 코드 검증을 수행하는 언어를 쓰거나 에러 생기기 쉬운 기능 사용의 최소화
    - 결함 탐지 및 정정: 테스팅 및 디버깅, 정적 분석 툴의 사용
    - 결함 감내: 런타임 검사 기능(Runtime Exception), 결함 감내 아키텍처 도입
- 결함 감내 아키텍처: 결함과 실패는 어쩔 수 없이 발생하므로 통제의 방법이 필요
    - 다중화(Redundancy)를 통해 시스템이 정상적으로 동작하도록 유지

### 신뢰도를 결정하는 5 요소

- **가용성**
    - 시스템이 서비스를 제 때 제공할 수 있는 능력
    - `(전체 시간 - 시스템 비정상 상태 기간) / 전체 시간`
    - 고가용성(High Availability): 특정 서버에 문제가 생겨도 다른 서버에서 사용자 요청을 처리할 수 있다
- **신뢰성**
    - 시스템이 서비스의 기능을 명세에 따라 제공하는 능력
- **안전성**
    - 시스템이 대규모의 실패 없이 정상적으로 동작하는 능력
- **보안성**
    - 고의적이고 급작스런 외부의 침입에도 시스템이 스스로를 보호할 수 있는 능력
- **회복탄력성**
    - 시스템에 손상이 발생하는 상황에 저항하거나 스스로를 복구할 수 있는 능력

# AWS 컴퓨팅 서비스

- **컴퓨팅 서비스: 내가 만든 프로그램을 실행시킬 환경을 제공하는 서비스**
- **IaaS(Infrastructure as a Service)**: 서비스형 인프라
    - 네트워킹 기능, 컴퓨터 및 데이터 스토리지 공간 제공
    - IT 리소스에 대해 가장 높은 수준의 유연성과 관리 제어 제공
    - 사용자 관리 책임 - 코드, 보안, 데이터베이스, OS
    - AWS 관리 책임 - 가상화, 네트워킹, 스토리지 및 서버 하드웨어
- **PaaS(Platform as a Service)**: 서비스형 플랫폼
    - 사용자는 코드만 관리하면 됨
- **SaaS(Software as a Service)**: 서비스형 소프트웨어
    - 클라우드 제공업체가 소프트웨어를 개발 및 유지 관리

## Elastic Compute Cloud(EC2)

- 기존 서버에서 실행하는 것과 동일한 유형의 애플리케이션을 호스팅할 수 있는 가상 머신
- 인스턴스: 가상 머신 1대
- 인터넷을 통해 사용자의 장치에서 인스턴스에 접근 - 암호화 통신을 위해 키 페어 사용
- 상태(수명 주기)
    - 대기 중
    - 실행 중
    - 중지 중 → 중지됨
    - 종료 중 → 종료됨
        - 종료 이후에도 일정시간 남아있다가 자동으로 사라짐
- S/W와 OS: `Amazon Machine Image` 사용
    - 이미지: 일종의 소프트웨어의 묶음
        - 미리 정의된 템플리승ㄹ 통해 지정된 종류와 버전의 소프트웨어가 설치된 하나의 파일
        - AMI 이미지를 저장장치에 설치하고 가상머신의 디스크로 사용하도록 지정
        - 빠른 시작 이미지로 자주 사용되는 이미지 적용
- CPU/Memory/Network: 인스턴스 타입
    - 사용 목적에 따라 사전 제공되는 규격(인스턴스 타입)을 사용
    - 범용: `M, T`
    - 컴퓨팅 최적화: CPU연산 위주 - `C`
    - 메모리 최적화: 메모리 작업이 많을 때 - `R, X`
    - 스토리지 최적화: 대량 데이터 저장 - `I, D`
    - Accelerated Computing: GPU난 FPGA 등 부가 장치 - `P, G`
- Storage: `Elastic Block Store` & 인스턴스 스토어
    - 디스크 용량
    - 처리량(Throughput): 초당 데이터 전송량
    - IOPS(Input/Output Per Seconds): 초당 읽기/쓰기 연산 수행 횟수
    - `처리량 = IOPS * 데이터 전송 크기(I/O Block Size)`
    - EBS 범용 SSD 타입(gp3)의 경우 기본적으로 3000 IOPS 및 125 Mbytes/s

### 인스턴스 선택의 기준 - 워크로드 유형(CPU 사용 시간, I/O wait)

- CPU 중심
    - 머신 러닝 - `TensorFlow`, `Keras`
    - 빅데이터 플랫폼 기반 SQL 엔진 - `SparkSQL on Hadoop`
- I/O 중심
    - ETL(Extract-Transform-Load) 작업
    - 로깅

## 스토리지

- 컴퓨터 아키텍처와 파일 - 논리적 볼륨을 나누어 파일 시스템을 독립적으로 운영
- 네트워크 스토리지: 서버에 직접 연결된 스토리지처럼 네트워크를 통해 원격에 위치한 디스크를 사용하는 기술
- EBS: AWS가 제공하는 네트워크 스토리지 서비스
    - EC2 인스턴스에 추가/제거 가능
    - 연결만 해서 가능한게 아니라, 인스턴스의 OS 상에서도 마운트를 해줘야 한다
    - 용량이 꽉 차 장애가 발생한 경우, 다른 인스턴스에 마운트 하여 정리한 후 다시 마운트 가능
- 디스크에 읽기/쓰기 시 바이트가 아닌 블록단위로만 접근
    - 최소 4KB를 1블록으로 지정(최대 1MB)
- HDD vs SSD
    - HDD는 헤드를 이동시켜 플래터의 섹터에서 데이터를 읽고 저장
    - SSD는 NAND 플래시 메모리에서 데이터 읽고 저장
    - I/O 한 번당 HDD가 SSD * 100의 부하가 생김
    - 속도 측면에서 SSD가 훨씬 빠르다
    - HDD는 최대 IOPS가 낮아 블록 사이즈가 작을수록 느려짐
- HDD 성능을 높이는법
    - I/O 블록 사이즈 키우기 - 연속된 섹터를 읽으면 키울 수 있다
    - Seek Time과 Rotational Latency 줄이기 - 저장 위치를 조절
- 가격 효율적으로 HDD 사용하는법
    - 대용량 데이터 저장이 필요할 때 사용
    - 연속 접근 I/O 패턴을 가지는 애플리케이션에 사용(ETL, OLAP 등)
    - 처리량 최적화:  마그네틱 스토리지(`st1`) 사용 - 버스트 모드(처리량 성능 최대치를 증가시킴)
- EBS 볼륨 유형
    - 범용 SSD(gp3): 1GB~16GB, 최대 16000 IOPS, 1000 MB/s
    - Provisioned IOPS SSD(gp2): 4GB~16TB, 최대 64000 IOPS, 1000 MB/s
        - IOPS 처리량을 추가로 설정하는 것을 Provisioning이라 함
- EBS 특징
    - 데이터 영구 보관
    - 볼륨에 문제 발생 시 복구 가능
    - 스냅샷과 Point-in-time Recovery
    - 데이터 암호화
    - 탄력적 볼륨 - 크기/성능 조정
- 인스턴스 스토어(EC2 인스턴스가 동작하는 물리 서버에 직접 연결된 디스크)
    - 데이터 영구 보관 불가
    - 중지 후 재시작 시 데이터 삭제
    - 종료 시 모든 데이터 삭제
    - 물리 디스크에 문제 발생 시 복구 불가
    - 빠른 성능
- EBS 스냅샷
    - 증분 백업
    - EBS 볼륨에 대해 스냅샷 생성 후 일정 시점 이후 다시 생성하는 경우 변경된 내역에 대해서만 스냅샷 생성
    - 저장공간 최적화 및 백업 시간 단축
    - 스냅샷 이미지는 S3에 저장
    - DB처럼 데이터가 디스크에 완전 반영 못하는 시점이 존재하는 경우 스냅샷으로 복구를 보장하지 못한다
    - 파일 레벨에서만 백업 진행

# 리소스

- 사용자가 생성하거나 AWS 서비스를 통해 자동으로 생성되는 모든 가상 자원
- EC2 인스턴스, EBS, 보안그룹(방화벽), 키 페어
- Amazon Resource Name: 리소스를 구분하기 위한 유일한 식별자
    - 서비스명
    - 리전
    - AWS 계정 ID
    - 리소스 유형
    - 리소스 ID
    - 선택적인 추가 구성 요소
    - 예시) `arn:aws:ec2:useast-1:123456789012:instance/i-01234567890abcdef`
- 태그: 리소스에 할당할 수 있는 레이블
    - 키-값으로 구성되면 값은 선택
    - 키가 Name인 태그를 기본적으로 리소스 의미 부여를 위해 사용
    - 태깅은 EC2 인스턴스에 의미와 정보를 부여한다 - IAM 사용자가 여러명일 때 태그로 설명
    - 태그로 **필터링, 자동화, 비용 할당, 액세스 제어**를 설정할 수 있다

# AWS 계정

- 계정과 사용자 관리: IAM(Identity and Access Management) 서비스로 사용자 관리
- Root 계정의 ID와 IAM 사용자의 ID/PW를 통해 로그인
- **IAM 사용자에 따라 서비스 사용에 대한 권한을 다르게 설정 가능**
    - 조회, 실행, 중지, 종료 권한 중 골라서 넣기 가능
    - 실제 사용자를 구분하고 사용자 별로 할 수 있는 일을 구분
    - IAM 역할은 리소스 그 자체에 권한 부여

# EC2 과금 모델

- **온디맨드 인스턴스**
    - 사용중인 인스턴스에 대해 시간 당 또는 초단위 과금
    - 처음 클라우드 도입 시나 개발 중일 때 사용
    - 들쑥날쑥한 워크로드
- **예약 인스턴스**
    - 1년 또는 3년 동안 특정 인스턴스 유형으로 특정 리전 내에서 약정
    - 그룹웨어, ERP, CRM, LMS 등의 운영에 주로 사용
    - 전체 선결제: 기간 시작 시점에 전액 선결제, 기간 동안 추가 비용없이 무제한 사용 - 할인율 높음
    - 부분 선결제: 비용 중 일부 선결제, 결제되지 않은 시간에 대해서는 예약 인스턴스 사용 여부와 상관없이 할인된 금액으로 요금 발생
    - 선결제 없음: 인스턴스 사용 여부와 관계없이 매 시간 할인된 요금으로 비용 발생 - 할인율 낮음
    - 꾸준한 상태의 워클도ㅡ
- **Savings Plans**
    - 인스턴스 타입을 지정하는 것이 아닌, 컴퓨팅 사용량에 대해 약정
    - 예약 이후 인스턴스 타입 변경하면 에약된 인스턴스에 준하는 컴퓨터 성능을 기준으로 환산하여 처리
    - Compute Savings Plans: EC2, Lambda, Fargate 사용량에 적용
    - EC2 Instance Savings Plans: 특정 EC2 인스턴스 패밀리에 대해서만 적용
    - Machine Learning Savings Plans: Sage Maker에 사용되는 컴퓨팅 사용량에 대해 적용
- **스팟 인스턴스**
    - 미사용 중인 인스턴스를 경매 방식으로 대여
    - 사용 중 더 높은 가격으로 다른 사용자가 요청할 경우 소유권을 뺏길 수 있다
    - 소유권을 뺏긴 경우 인스턴스 종료 공지 후 2분 내 종료
    - 가장 저렴한 방식으로, 온디맨드 대비 최대 90% 할인
    - 인스턴스가 불특정 시점에 종료되어도 상관 없는 경우에 사용 - 개발 인스턴스
- **온디맨드 용량 예약**
    - 원하는 기간동안 특정 가용 영역의 EC2 인스턴스에 대해 용량을 예약
- 전용 호스트
    - 데이터 센터의 물리 서버를 할당받아 사용자가 지정한 인스턴스만 해당 서버에서 구동
    - 물리 서버에 대해 라이선스 비용을 지불해야 하는 경우 사용
- 전용 인스턴스
    - 물리 서버를 할당받아 사용자 계정 내 인스턴스만 구동할 수 있다
    - 계정 내 전용 인스턴스가 아닌 일반 인스턴스가 물리 서버를 사용할 수 있으며, 사용자가 제어할 수 없다
    - 매우 민감한 워크로드

# 서비스 할당량(Quotas)과 예산 관리

- AWS는 서비스 별로 할당량을 제한하고 있다
- 유한한 컴퓨팅 자원 - 사용자 별 자원 할당량을 제어하는 것이 필요
- 의도치 않게 원하는 양보다 큰 수준의 리소스를 사용해 과소비하는 것을 방지
- 특정 사용자가 리소스를 독차지하여  다른 사용자가 할당받지 못하는 것을 방지하기 위한 목적
- **AWS Service Quotas**를 통해 계정에 주어진 할당량을 조절할 수 있다
    - 서비스 할당량의 중앙 집중식 관리
    - 할당량 가시성 향상
    - 쉬운 할당량 증가 요청 - 콘솔 또는 API 호출
    - 선제적 할당량 관리 - CloudWatch와 통합되어 관리되고 임계값 도달 시 경고를 통해 선제적 관리
    - AWS Organizations 신규 계정 할당량 요청 간소화 - Organizations를 통해 증가 요청
- **AWS Budgets:** 사용가능한 예산을 미리 설정하여 접근하거나 넘어섰을 경우 경보를 받을 수 있는 서비스
- **AWS Organizations**: 하나의 회사에서 여러 부서에 각자 계정을 생성해서 운영하는 상황에 비용을 합쳐서 관리하기 위한 기능
- **AWS Support**: 클라우드를 처음 접하는 사용자가 클라우드 환경에 적응하기 위한 도움을 주는 서비스
- 지원 플랜: AWS 엔지니어 등으로부터 질의응답을 받거나 계정의 상태를 공유하고 문제 해결을 진행하는 전문 서비스
    - 베이직: 기본 플랜(무료) - 기술 지원 불가
    - Developer: 0800~1800 메일을 통한 일반적인 사항 또는 시스템 부분 장애에 대한 고객 지원
    - Business: 24/7 이메일/채팅/전화를 통한 일반적인 사항, 일반 시스템 손상, 프로덕션 시스템 손상이나 중단에 대한 지원
    - Enterprise On-Ramp: 비즈니스 + 크리티컬 시스템 중단에 대한 지원, TAM(Technical Account Manager) 지원
    - Enterprise: 미션 크리티컬 워크로드에 적합, 장애 시 15분내 응답 보장
    - Trusted Advisor: 사용중인 서비스의 자원들을 분석하여 모범 사례에 부합하지 않는 요소 검출 및 알림
        - 비용 최적화
        - 성능
        - 보안
        - 내결함성(고가용성)
        - 서비스 할당량

# IAM과 보안

- Root 계정 보안
    - 모든 행위를 할 수 있는 권한이 있기 때문에 탈취당할 경우 심각한 피해가 발생한다
    - IAM 사용자 사용을 권장
    - MFA(Multi-Factor Authentication) 활성화 필수 - OTP
- AWS 서비스 사용법
    - AWS 관리 콘솔
    - AWS CLI, SDK
- ID와 암호
    - IAM 서비스에서 사용자 생성 시, 암호 제약사항 지정 가능(최소 길이, 대소문자, 특수문자 등)
    - MFA
- CLI, SDK에서의 인증
    - Access Key와 Secret Access Key를 이용해 서비스 이용
    - SSH 키처럼 파일형태로 저장
    - GitHub나 메일로 전송 시, 보안 문제 우려
    - Security Token Service로 MFA 적용 가능
- 사용자 그룹
    - 개개인 별로 권한을 지정하는 것은 매우 어렵고 복잡하기 때문에 그룹을 만들어 권한을 부여하고 사용자를 추가
- 정책: IAM 사용자(그룹)에 부여할 AWS 서비스 사용 권한을 제어
    - JSON 포맷으로 표현(AWS Policy Generator)
    - `Action`: 대상이 되는 AWS 리소스(EC2)
    - `Effect`: 행위의 허용(Allow)/거부(Deny)
    - `Resource`: 행위의 대상이 되는 AWS 리소스
    - `SID`, `Condition`을 선택적으로 추가
    - `ScopePermissions`: 스스로 PermissionBoundary를 설정한 후 권한을 함부로 수정/삭제 못하게 함
- IAM 역할: 권한 제어에 사용
    - 어플리케이션이나 특정 서비스에서 사용 - 인증이 필요없음
    - 생성과정에서 해당 역할을 신뢰할 수 있는 엔티티를 지정(AWS 서비스, 다른 계정, 제 3자 페더레이션 계정)
    - 신뢰할 수 있는 엔티티는 해당 역할을 이용해 서비스 이용 가능(역할에 명시된 권한 내에서만)

# AWS CLI

- 커맨드라인에서 AWS 사용하기 위한 기능을 제공하는 파이썬 기반 인터페이스
- 모든 AWS 서비스에 대한 통합 인터페이스 - 콘솔에서 지원되지 않는 기능 포함