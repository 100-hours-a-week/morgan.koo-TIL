# SSH

## 포트포워딩

- 와이파이는 PC, TV 등에 연결
    - 그렇다면 와이파이는 ISP(인터넷 서비스 프로바이더 - KT, SKB, U+)에서 나온 공인 IP 연결
    - PC, TV는 Private IP(사설IP)로 연결 - 인터넷 통신X
    - 사설IP → 공인IP를 NAT가 해줌 - 인터넷 연결
- 그렇다면 포트포워딩은?
    - 기본적인 웹 서비스는 443, 80포트 사용
    - SSH는 22포트
    - 외부에서 올땐 공인 IP 통해서 오니 와이파이에서 포트를 부여 후 매핑(테이블)
    - 사설 IP 내 포트로 전달하는 것이 포트포워딩!
    - 나갈때는 NAT로

## SSH 서버

- `netstat` : 네트워크 상태
- `netstat -ntlp`로 현재 포트 정보 확인 가능
- `ifconfig` - inet 뒤의 ip로 접속하면 된다

## 루트 권한

- 루트 계정으로 접속 시키는 것을 권장하지 않는다!
- 우분투는 루트 로그인을 제한함
    - 브루트 포스 공격을 방어하는 루틴을 설정해야 함
- 슈퍼유저/루트 사용자 - 시스템 관리 권한을 갖고 있는 사용자
- `sudo` 명령으로 루트 권한 획득 (etc에 포함)

## 사용자 계정 관리

### 추가

- `useradd [옵션] [계정명]` 으로 추가
    - `sudo useradd -m [계정명]` : 유저 추가 및 home 디렉토리 생성
- `sudo passwd [계정명]`
    - 비밀번호 설정

### 삭제

- `sudo userdel [계정명]`
- `sudo rm -rf /home/[계정명]` 으로 디렉토리 삭제도 필요

### sudo 권한

- `/etc/sudoers`에서 설정한다 - vi 사용
- `usermod [옵션] [계정명]`: 계정 정보 변경
    - `-a`: 정보 추가(반드시 필요)
    - `-G`: 그룹 변경

## 리눅스 파일

- 모든 파일에 소유권과 접근 권한이 부여된다
- 엄격한 대소문자 구별
    - 특수문자X
- `ls -al`: 폴더의 상세정보(사용자 접근권한, 그룹 접근권한, 소유권 등)
    - `ls -a`: 숨김 파일도 보여줌(뒤의 l은 리스트 형태로 출력하기)
    - 파일 종류: `d`(디렉토리), `-`(파일)
    - 권한 종류: `r`(읽기, 4),`w`(쓰기, 2),`x`(실행, 1), `-`(없음, 0)
- `chown [옵션] [계정 및 그룹] [파일명]`: 소유자 변경
    - `-R` 옵션: 디렉토리와 해당 디렉토리 내 모든 파일의 소유권 동시에 변경
- `chmod [레퍼런스] [접근권한] [파일]`: 접근권한 변경
    - `u`(소유자), `g`(그룹), `o`(다른 사용자), `a`(모든 사용자)
    - `+`(부여), `-`(해제)
    - 예시) `morgan@ubuntu:/tmp$ chmod ugo+rwx sample` = ‘sample’ 파일에 대해 ugo(소유자, 그룹, 다른 사용자)에게 rwx(읽기, 쓰기, 실행하기) 권한을 부여(추가) 한다
    - 소유자 권한은 100의 자리, 그룹 사용자 권한은 10의 자리, 기타 사용자 권한은 1의 자리에 넣어 합산한 세자리 숫자로 한번에 부여 가능(777, 421, 442 등)
        - 예시) `morgan@ubuntu:/tmp$ chmod 644 sample` = ‘sample’ 파일에 대해 파일소유자에게 읽기+쓰기, 그룹 사용자에게 읽기, 기타 사용자에게 읽기 권한을 부여한다
- 기본 시스템 디렉토리는 삭제 및 변경하면 안된다
    - `cp`로 백업하는 것을 권장
- `mkdir`: 디렉토리 생성
    - `mkdir -p`: 상위 디렉토리를 포함하는 하위 디렉토리 생성
- `rmdir`: 디렉토리 삭제(비어있는)
    - `rm -r`은 비어있지 않은 디렉토리도 삭제
- `touch`: 빈 파일 생성
- `cp`: 파일 복사
    - `cp -r`: 디렉토리 복사
- `mv [옵션] [원본] [사본]`: 파일/디렉토리 옮기기
- `rm`: 파일 삭제(복원 가능)
    - `rm -rf` 하위 디렉토리 포함 모든 파일 삭제(완전 삭제)
- `cat`: 파일 내용 보기
    - `cat > [파일명]`: 화면 대신 새로운 파일로 만들기
- `more`: 파일 내용을 화면에 나누어 표시하기
- `less`: more과 유사
- `head/tail`: 하위 10번째 표시(에러 로그 확인 시 용이함)
    - `-n`: 몇번째까지 인지 옵션 추가
    - `-f`: 실시간 모니터링 옵션
- `find [탐색경로] [옵션] [표현식]`: 파일 검색
    - `-name`: 이름
    - `-perm`: 파일 권한 기준
    - `-type`: 파일 종류 기준
    - `-size`: 파일 크기
    - `-links`: 링크 수
    - `-user`: 사용자 ID
    - `-atime`: 특정 기간 이상 접근하지 않은 파일
    - `-mtime`: 특정 시간 이상 수정되지 않은 파일
- `grep`: 파일내용 검색하기
    - `-c`: 문자열 포함된 행 개수
    - `-n`: 행과 줄번호 표시
- `|`: 여러명령 동시에 사용
    - `ls -al | sort -r | more`: 파일 목록을 역순으로 정렬하여 화면 단위로 출력

## 리눅스 프로세스

- 실행 중인 프로그램
- 프로그램을 실행하면 프로세스가 메모리에 적재된다
- 프로세스 정보
    - PID(Process ID): 프로세스 식별 번호
    - UID(User ID): 프로세스 소유하는 사용자 계정 식별 번호
    - GID(Group ID): 그룹 식별 번호
    - 파일 디스크립터: 프로세스가 사용하고 있는 파일 정보
- `ps`: 현재 실행중인 프로세스를 확인하는 명령
    - `-a`: 다른 사용자의 프로세스 상태
    - `-x`: 화면에 보이지 않는 프로세스 정보
    - `-u`: 프로세스 사용자와 실행시간
    - `-aux`: 프로세스의 시스템 자원 사용률
    - `-ef`: pid 순으로 정렬된 프로세스들 출력
        - PPID: 부모 프로세스 PID
        - C: 프로세스의 CPU 점유 상태
        - STIME: 프로세스가 시작된 시간
        - TTY: 프로세스가 시작되고 있는 터미널
- 프로세스 상태(STAT)
    - 실행 대기(R)
    - 수면(S)
    - 입출력 대기(D)
    - 멈춤(T)
    - 죽음(Z)
- `top`: 실시간으로 실행중인 프로세스 모니터링(5초 단위 갱신)
    - `n`: pid 순
    - `m`: 메모리 사용률 순
    - `t`: 사용 시간 기준 정렬
    - `q`: 종료
- APM, Scouter 등 솔루션

### 프로세스 종료

- `kill -[신호] [pid]`: 종료 명령
    - 기본은 -15(SIGTERM)
    - -9: 강제종료(SIGKILL)
    - -1: 재실행(SIGHUB)

### 포그라운드와 백그라운드

- 포그라운드: 명령 실행하여 프로세스 종료까지 기다림
- 백그라운드: 프로세스 종료 기다리지 않는다
- &: 프로세스를 백그라운드로 보내 명령 처리(명령 뒷쪽에 추가)
    - 예시) `sudo find -name a*&`
    - `ps -ef`로만 해당 프로세스 찾을 수 있음

### 문자열 관련 메타 문자

- `find`와 같은 스크립트 작성에 용이함
    - 특정 기간내 웹 로그를 압축 및 삭제 처리하기
- *: 모든문자
- ?: 하나의 문자
- []: 괄호 안 문자 대체

## 패키지 관리

- `dpkg [옵션] [명령]`
    
    
    | 옵션 | 뜻 |
    | --- | --- |
    | -i | 패키지 설치 또는 최신 버전으로 업데이트 |
    | -r | 설정 파일은 그대로 두고 패키지 삭제 |
    | -P | 패키지와 함께 설정 파일까지 삭제 |
    | -C | 패키지가 제대로 설치되었는지 확인 |
    | -s | 패키지 정보 출력 |
    | -L | 패키지 속 들어있는 파일과 경로 확인 |
    | -l [패턴] | 패턴과 일치하는 패키지 출력 |
- `apt`로 패키지 관리
    - 패키지 저장소 주소를 /etc/apt/sources.list에 저장
    - `apt-get [명령] [옵션] [패키지]` : 패키지를 내려받고 설치
        
        
        | 명령 | 뜻 |
        | --- | --- |
        | update | sources.list에서 패키지 목록 받아오기 |
        | upgrade | 모든 패키지의 최신 업데이트를 검색하여 설치 |
        | install | 패키지 설치 |
        | remove | 패키지 삭제 |
        | autoclean | 불안전하게 다운로드된 패키지나 오류가 발생한 패키지 삭제 |
        
        | 옵션 | 뜻 |
        | --- | --- |
        | -d | 패키지를 설치하지는 않고 패키지 저장소에서 내려받기만 함 |
        | -f | 의존성 문제가 생겼을 때 시스템 정상화 |
        | -u | 업그레이드된 패키지를 보여줌 |
        | --purge | 설정 파일까지 모두 삭제 |
        | --reinstall | 이미 설치된 패키지 혹은 새 버전의 패키지 다시 설치 |
    - `apt-cache [명령] [패턴] [패키지]`: 패키지 찾고 정보 확인
    | 명령 | 뜻 |
| --- | --- |
| search [패턴] | [패턴]에 해당하는 패키지 검색 |
| showpkg | 패키지 의존 관계 |
| stats | 시스템에 설치되어 있는 전체 패키지 요약 정보 |
| show | 해당 패키지에 대한 구체적인 정보 |